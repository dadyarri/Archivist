<?xml version="1.0" encoding="utf-8"?>
<Page x:Class="Archivist.Views.CreateSummaryPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      mc:Ignorable="d"
      x:Name="CreatePage">

  <Grid Padding="20">
    <Grid HorizontalAlignment="Center"
          MaxWidth="1200">
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto" />
        <RowDefinition Height="Auto" />
      </Grid.RowDefinitions>

      <!-- Main content row with steps side by side -->
      <Grid x:Name="StepsContainer"
            Grid.Row="0"
            Visibility="{x:Bind ViewModel.StepsVisibility, Mode=OneWay}">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="20" />
          <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!-- Step 1: Folder Selection -->
        <Border Grid.Column="0"
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                CornerRadius="8"
                Padding="20"
                Height="400">
          <StackPanel Orientation="Vertical"
                      Spacing="15">
            <TextBlock Text="1. Выберите папку с аудиофайлами"
                       Style="{StaticResource SubtitleTextBlockStyle}" />

            <StackPanel Orientation="Horizontal"
                        Spacing="10">
              <Button Content="Выбрать папку"
                      Command="{x:Bind ViewModel.SelectFolderCommand}"
                      HorizontalAlignment="Left" />
              <TextBlock Text="{x:Bind ViewModel.SelectedFolderText, Mode=OneWay}"
                         Style="{StaticResource BodyTextBlockStyle}"
                         VerticalAlignment="Center"
                         Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
            </StackPanel>
          </StackPanel>
        </Border>

        <!-- Step 2: Character Configuration (initially hidden) -->
        <Border x:Name="Step2Border"
                Grid.Column="2"
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                CornerRadius="8"
                Padding="20"
                Height="400"
                Visibility="{x:Bind ViewModel.Step2Visibility, Mode=OneWay}">
          <StackPanel Orientation="Vertical"
                      Spacing="15">
            <TextBlock Text="2. Настройте персонажей для аудиофайлов"
                       Style="{StaticResource SubtitleTextBlockStyle}" />

            <TextBlock Text="{x:Bind ViewModel.NoFilesText, Mode=OneWay}"
                       Style="{StaticResource BodyTextBlockStyle}"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                       Visibility="{x:Bind ViewModel.NoFilesVisibility, Mode=OneWay}" />

            <ListView ItemsSource="{x:Bind ViewModel.AudioFiles, Mode=OneWay}"
                      Visibility="{x:Bind ViewModel.AudioFilesVisibility, Mode=OneWay}"
                      MaxHeight="300"
                      SelectionMode="None">
              <ListView.ItemTemplate>
                <DataTemplate>
                  <Border Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                          CornerRadius="4"
                          Padding="15"
                          Margin="0,0,0,8">
                    <Grid>
                      <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                      </Grid.ColumnDefinitions>

                      <StackPanel Grid.Column="0"
                                  Orientation="Vertical"
                                  Spacing="5">
                        <TextBlock Text="{Binding FileName}"
                                   Style="{StaticResource BodyTextBlockStyle}"
                                   FontWeight="SemiBold" />
                        <TextBox Text="{Binding CharacterName, Mode=TwoWay}"
                                 PlaceholderText="Введите имя персонажа"
                                 Width="200"
                                 HorizontalAlignment="Left" />
                      </StackPanel>

                      <Button Grid.Column="1"
                              Content="Удалить"
                              Command="{Binding ElementName=CreatePage, Path=DataContext.RemoveFileCommand}"
                              CommandParameter="{Binding}"
                              VerticalAlignment="Center"
                              Style="{StaticResource AccentButtonStyle}"
                              Padding="10,5" />
                    </Grid>
                  </Border>
                </DataTemplate>
              </ListView.ItemTemplate>
            </ListView>
          </StackPanel>
        </Border>
      </Grid>

      <!-- Progress card (independent, initially hidden) -->
      <Border x:Name="ProgressBorder"
              Grid.Row="1"
              Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
              CornerRadius="8"
              Padding="20"
              Margin="0,20,0,0"
              Width="800"
              HorizontalAlignment="Center"
              Visibility="{x:Bind ViewModel.ProgressVisibility, Mode=OneWay}">
        <StackPanel Orientation="Vertical"
                    Spacing="15">
          <TextBlock Text="{x:Bind ViewModel.ProgressStageTitle, Mode=OneWay}"
                     Style="{StaticResource SubtitleTextBlockStyle}" />

          <ProgressBar Value="{x:Bind ViewModel.ProgressValue, Mode=OneWay}"
                       Maximum="100"
                       Height="8" />

          <TextBlock Text="{x:Bind ViewModel.ProgressText, Mode=OneWay}"
                     Style="{StaticResource BodyTextBlockStyle}"
                     HorizontalAlignment="Center"
                     TextWrapping="Wrap" />

          <Button Content="Отмена"
                  Command="{x:Bind ViewModel.CancelCommand}"
                  HorizontalAlignment="Center" />
        </StackPanel>
      </Border>

      <!-- Bottom row with create summary button -->
      <Grid Grid.Row="2"
            Margin="0,20,0,0">
        <Button Content="Написать саммари"
                Command="{x:Bind ViewModel.CreateSummaryCommand}"
                HorizontalAlignment="Center"
                IsEnabled="{x:Bind ViewModel.CreateSummaryEnabled, Mode=OneWay}"
                Visibility="{x:Bind ViewModel.CreateSummaryVisibility, Mode=OneWay}"
                Style="{StaticResource AccentButtonStyle}"
                Padding="20,10" />
      </Grid>
    </Grid>
  </Grid>
</Page>
